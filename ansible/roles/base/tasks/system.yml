---
- name: System | Update apt cache
  apt:
    upgrade: 'dist'
    update_cache: true
    cache_valid_time: '{{ 60 * 60 * 24 }}'

- name: System | Install packages
  apt:
    state: present
    package: "{{ default_packages }}"

- name: System | Set swappiness
  ansible.posix.sysctl:
    name: "{{ sysctl.name }}"
    value: "{{ sysctl.value }}"
    state: present
  loop_control:
    loop_var: 'sysctl'
    label: "{{ sysctl.name }}: {{ sysctl.value }}"
  loop:
    - { name: "vm.swappiness", value: "{{ system.vm_swappiness }}" }
    - { name: "vm.vfs_cache_pressure", value: "{{ system.vfs_cache_pressure }}" }
  tags: ['skipci']

- name: System | Secure shared memory
  mount:
    src: none
    path: /run/shm
    fstype: tmpfs
    opts: rw,noexec,nosuid,nodev
    state: mounted
  tags: ['skipci']

- name: System | Create rocketpool user
  user:
    name: "{{ rocketpool.user }}"
    shell: /bin/bash
